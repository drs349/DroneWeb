{
  "name": "mavlink",
  "version": "1.0.1",
  "description": "Encode and decode MAVLink messages",
  "main": "src/mavlink.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/omcaree/node-mavlink.git"
  },
  "keywords": [
    "node.js",
    "mavlink"
  ],
  "dependencies": {
    "xml2js": ""
  },
  "author": {
    "name": "Owen McAree"
  },
  "license": "BSD",
  "readmeFilename": "Readme.md",
  "gitHead": "c30f8a63ca6a1ebc1669fefcd07bb3780540e41b",
  "readme": "A Node.js module for encoding/decoding MAVLink messages\r\n======================================================================\r\n\r\nThis module for Node.JS allows you to transmit and receive MAVLink encoded messages. [MAVLink](http://qgroundcontrol.org/mavlink/start) is a lightweight message marshalling system designed for Micro Aerial Vehicles (MAVs) which efficiently encodes data in to binary packets to be transmnitted over serial or network connection.\r\n\r\nThis module allows your application to communicate with other systems using MAVLink, such as the [Ardupilot Mega autopilot](http://store.3drobotics.com/products/apm-2-5-kit).\r\n\r\nnode-mavlink parses the XML based message definitions on initialisation and automatically decodes any incoming messages in to their corresponding fields. This allows you to utilise the MAVLink protocol from a node application without having to understand the its inner workings. \r\n\r\nBoth MAVLink v0.9 and v1.0 are available, although v0.9 support is untested.\r\n\r\nInstallation\r\n============\r\n\r\nTo install node-mavlink use\r\n\r\n```\r\nnpm install mavlink\r\n```\r\n\r\nUsage\r\n=====\r\n\r\nInitialisation\r\n--------------\r\n\r\nTo start decoding MAVLink messages you must create a new instance of node-mavlink for the particular System and Component ID's. For example,\r\n```\r\nvar mavlink = require('mavlink');\r\n\r\nvar myMAV = new mavlink(1,1);\r\n```\r\n\r\nIf you wish to receive all incoming messages, regardless of system and component IDs, set them both to 0. Note that if they are set to zero you will be unable to encode/send messages.\r\n\r\nAdditional arguments to the constructor are available to specify which version of MAVLink to use and which message definitions to load. A full constructor call would be\r\n```\r\nvar myMAV = new mavlink(1,1,\"v1.0\",[\"common\", \"ardupilotmega\"]);\r\n```\r\nThis will use v1.0 and load the definition files common.xml and ardupilotmega.xml. Note that these are the default values if these arguments are ommitted.\r\n\r\nYou MUST wait for the \"ready\" event before attempting to use node-mavlink, see the Parsing Data section below.\r\n\r\nMessage Object\r\n--------------\r\nWhen receiving or creating messages, data is stored within a message object. The fields of this object are\r\n * length - The payload length\r\n * sequence - The sequence counter (loops from 0-255)\r\n * system - The system ID of the message origin\r\n * component - The component ID of the message origin\r\n * id - The numerical ID of the message\r\n * payload - Buffer containing the payload data\r\n * checksum - The message checksum (As transmitted)\r\n * buffer - Buffer containing the entire message, as required when transmitting the message\r\n \r\nIn addition to the message object, incoming data is automatically parsed in to individual fields. This is described in the next section.\r\n\r\nParsing Data\r\n------------\r\n\r\nYou MUST wait for the \"ready\" event before attempting to use node-mavlink as the XML parsing can take a few seconds to complete. You can then begin parsing incoming data (from a serialport for example) and listening to messages\r\n```\r\nmyMAV.on(\"ready\", function() {\r\n\t//parse incoming serial data\r\n\tserialport.on('data', function(data) {\r\n\t\tmyMAV.parse(data);\r\n\t});\r\n\t\r\n\t//listen for messages\r\n\tmyMAV.on(\"message\", function(message) {\r\n\t\tconsole.log(message);\r\n\t});\r\n});\r\n```\r\n\r\nThis will print out the object containing encoded message data as it arrives, these look something this...\r\n\r\n```\r\n{ length: 28,\r\n  sequence: 24,\r\n  system: 1,\r\n  component: 1,\r\n  id: 33,\r\n  payload: <Buffer 8c 7d 51 00 00 00 00 00 00 00 00 00 28 17 02 00 00 00 00 00 00 00 00 00 00 00 00 00>,\r\n  checksum: 44001,\r\n  buffer: <Buffer fe 1c 18 01 01 21 8c 7d 51 00 00 00 00 00 00 00 00 00 28 17 02 00 00 00 00 00 00 00 00 00 00 00 00 00 e1 ab> }\r\n```\r\n\r\nYou can also listen for specific messages, such as \"ATTITUDE\", this will return the encoded message as above, and the decoded fields. For example,\r\n```\r\n\tmyMAV.on(\"ATTITUDE\", function(message, fields) {\r\n\t\tconsole.log(fields);\r\n\t});\r\n```\r\n\r\nThis will print the decoded fields object\r\n\r\n```\r\n{ time_boot_ms: 1342833404,\r\n  roll: -0.0003465251356828958,\r\n  pitch: 0.004853600636124611,\r\n  yaw: 0,\r\n  rollspeed: 0.0016423191409558058,\r\n  pitchspeed: 0.0016250653425231576,\r\n  yawspeed: 0.003961517941206694 }\r\n```\r\n\r\nYou can access these fields in the standard way, e.g.\r\n```\r\n\tmyMAV.on(\"ATTITUDE\", function(message, fields) {\r\n\t\tconsole.log(\"Roll is \" + fields.roll + \"\\nPitch is \" + fields.pitch);\r\n\t});\r\n```\r\n\r\nComposing Messages\r\n-----------------\r\n\r\nTo create a message you simply pass an object to the createMessage function along with a callback function which is executed upon completion, for example\r\n\r\n```\r\n\tmyMAV.createMessage(\"GPS_STATUS\",\r\n\t\t{\r\n\t\t'satellites_visible':\t\t5,\r\n\t\t'satellite_prn':\t\t\t[1, 2, 3, 4, 5],\r\n\t\t'satellite_used':\t\t\t[2, 3, 4, 5, 6],\r\n\t\t'satellite_elevation':\t\t[3, 4, 5, 6, 7],\r\n\t\t'satellite_azimuth':\t\t[4, 5, 6, 7, 8],\r\n\t\t'satellite_snr':\t\t\t[5, 6, 7, 8, 9]\r\n\t\t},\r\n\t\tfunction(message) {\r\n\t\t\tserialport.write(message.buffer);\r\n\t\t});\r\n```\r\n\r\nArrays need not be fully specified (e.g. in the above example the arrays are all defined at uint8_t[20]), all other elements will default to zero.\r\n\r\nEvents\r\n------\r\nThe events emitted by node-mavlink are:\r\n\r\n* \"ready\" - MAVLink message definitions have been loaded, node-mavlink can be used\r\n* \"sequenceError\" - Two messages have been received sequentially whose sequence counter are not sequential (indicitive of data loss). The sequence mismatch is passed as an argument\r\n* \"message\" - Valid message received. The corresponding message object is passed as argument.\r\n* \"checksumFail\" - A message has been received but has failed the checksum. Various debugging information is passed as arguments, see mavlink.js for details\r\n\r\nIn addition to these events, each message received emits an event corresponding to the message type. For example on receipt of a GPS_RAW_INT message an event named \"GPS_RAW_INT\" is emitted. These events have both the message object passed as first argument along with an object containing the decoded fields. An example of this is given in the Parsing Data section above. \r\n\r\nThese message specific events allow you to tailor certain behaviours to certain message types, whilst ignoring other messages. For example, updating the aim of a tracking antenna whenever new position information is available.",
  "bugs": {
    "url": "https://github.com/omcaree/node-mavlink/issues"
  },
  "homepage": "https://github.com/omcaree/node-mavlink",
  "_id": "mavlink@1.0.1",
  "_from": "mavlink@~1.0.1"
}
